<div class="max-w-2xl mx-auto">
  <%= render "shared/page_header",
      title: "리뷰 작성",
      description: "신고 ##{@request.id} - #{@request.master&.name} 마스터에 대한 리뷰를 작성해 주세요.",
      back_path: customers_request_path(@request),
      back_text: "신고 상세로 돌아가기" %>

  <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
    <%= form_with(model: [@request, @review], url: customers_request_reviews_path(@request), class: "space-y-6") do |f| %>

      <%= render "shared/form_errors", resource: @review %>

      <%
        rating_fields = [
          { field: :punctuality_rating, label: "시간 준수", desc: "약속 시간을 잘 지켰나요?" },
          { field: :skill_rating, label: "기술력", desc: "전문적인 시공 능력은 어땠나요?" },
          { field: :kindness_rating, label: "친절도", desc: "친절하고 설명을 잘 해주었나요?" },
          { field: :cleanliness_rating, label: "뒷정리", desc: "작업 후 정리를 깨끗하게 했나요?" },
          { field: :price_rating, label: "가격 만족", desc: "가격 대비 만족도는 어떤가요?" }
        ]
      %>

      <% rating_fields.each do |rf| %>
        <div class="border-b pb-5 last:border-b-0 last:pb-0">
          <label class="block text-sm font-medium text-gray-900 mb-1"><%= rf[:label] %></label>
          <p class="text-xs text-gray-500 mb-3"><%= rf[:desc] %></p>
          <div class="flex items-center gap-1" data-controller="star-rating" role="radiogroup" aria-label="<%= rf[:label] %> 평점">
            <% (1..5).each do |n| %>
              <label class="cursor-pointer">
                <%= f.radio_button rf[:field], n,
                      class: "hidden peer",
                      data: { star_rating_target: "input", action: "change->star-rating#update" } %>
                <svg class="w-8 h-8 text-gray-300 peer-checked:text-yellow-400 hover:text-yellow-400 transition"
                     fill="currentColor" viewBox="0 0 20 20"
                     tabindex="0" role="radio" aria-label="<%= n %>점"
                     data-star-rating-target="star" data-value="<%= n %>"
                     data-action="click->star-rating#select keydown->star-rating#keydown">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              </label>
            <% end %>
            <span class="ml-2 text-sm text-gray-500" data-star-rating-target="label">선택해 주세요</span>
          </div>
        </div>
      <% end %>

      <!-- 코멘트 -->
      <div>
        <%= f.label :comment, "후기", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_area :comment,
              rows: 4,
              placeholder: "마스터에 대한 솔직한 후기를 남겨 주세요.",
              class: input_classes(:textarea) %>
      </div>

      <!-- 제출 버튼 -->
      <div class="flex items-center justify-end gap-3 pt-4 border-t">
        <%= link_to "취소", customers_request_path(@request), class: btn_classes(:secondary, :md) %>
        <%= f.submit "리뷰 등록", class: btn_classes(:primary, :md) %>
      </div>
    <% end %>
  </div>
</div>
