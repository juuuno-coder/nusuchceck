<div class="max-w-2xl mx-auto">
  <div class="mb-6">
    <%= link_to customers_request_path(@request), class: "text-sm text-blue-600 hover:text-blue-800 flex items-center" do %>
      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      신고 상세로 돌아가기
    <% end %>
    <h1 class="text-2xl font-bold text-gray-900 mt-2">리뷰 작성</h1>
    <p class="text-sm text-gray-500 mt-1">신고 #<%= @request.id %> - <%= @request.master&.name %> 마스터에 대한 리뷰를 작성해 주세요.</p>
  </div>

  <div class="bg-white rounded-lg shadow p-6">
    <%= form_with(model: [@request, @review], url: customers_request_reviews_path(@request), class: "space-y-6") do |f| %>

      <% if @review.errors.any? %>
        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
          <h3 class="text-sm font-medium text-red-800 mb-2">입력 오류가 있습니다:</h3>
          <ul class="list-disc list-inside text-sm text-red-700 space-y-1">
            <% @review.errors.full_messages.each do |msg| %>
              <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <%
        rating_fields = [
          { field: :punctuality_rating, label: "시간 준수", desc: "약속 시간을 잘 지켰나요?" },
          { field: :skill_rating, label: "기술력", desc: "전문적인 시공 능력은 어땠나요?" },
          { field: :kindness_rating, label: "친절도", desc: "친절하고 설명을 잘 해주었나요?" },
          { field: :cleanliness_rating, label: "뒷정리", desc: "작업 후 정리를 깨끗하게 했나요?" },
          { field: :price_rating, label: "가격 만족", desc: "가격 대비 만족도는 어떤가요?" }
        ]
      %>

      <% rating_fields.each do |rf| %>
        <div class="border-b pb-5 last:border-b-0 last:pb-0">
          <label class="block text-sm font-medium text-gray-900 mb-1"><%= rf[:label] %></label>
          <p class="text-xs text-gray-500 mb-3"><%= rf[:desc] %></p>
          <div class="flex items-center gap-1" data-controller="star-rating">
            <% (1..5).each do |n| %>
              <label class="cursor-pointer">
                <%= f.radio_button rf[:field], n,
                      class: "hidden peer",
                      data: { star_rating_target: "input", action: "change->star-rating#update" } %>
                <svg class="w-8 h-8 text-gray-300 peer-checked:text-yellow-400 hover:text-yellow-400 transition"
                     fill="currentColor" viewBox="0 0 20 20"
                     data-star-rating-target="star" data-value="<%= n %>">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              </label>
            <% end %>
            <span class="ml-2 text-sm text-gray-500" data-star-rating-target="label">선택해 주세요</span>
          </div>
        </div>
      <% end %>

      <!-- 코멘트 -->
      <div>
        <%= f.label :comment, "후기", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_area :comment,
              rows: 4,
              placeholder: "마스터에 대한 솔직한 후기를 남겨 주세요.",
              class: "w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
      </div>

      <!-- 제출 버튼 -->
      <div class="flex items-center justify-end gap-3 pt-4 border-t">
        <%= link_to "취소", customers_request_path(@request), class: "px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium text-sm" %>
        <%= f.submit "리뷰 등록", class: "px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium text-sm cursor-pointer" %>
      </div>
    <% end %>
  </div>
</div>
