<div class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50" data-controller="insurance-step" data-insurance-step-total-steps-value="5">
  <!-- 상단 헤더 -->
  <div class="bg-white border-b border-gray-200 sticky top-0 z-10 shadow-sm">
    <div class="max-w-2xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <%= link_to customers_requests_path, class: "text-gray-600 hover:text-gray-900 transition" do %>
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        <% end %>

        <div class="flex items-center gap-2 text-sm">
          <span id="autoSaveIndicator" class="text-gray-500">자동 저장됨</span>
          <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
          </svg>
        </div>
      </div>

      <!-- 프로그레스 바 -->
      <div class="mt-4">
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm font-medium text-gray-700">
            <span data-insurance-step-target="progress">1/5</span> 단계
          </span>
          <span class="text-xs text-gray-500">3분이면 끝나요</span>
        </div>
        <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
          <div data-insurance-step-target="progressBar" class="h-full bg-gradient-to-r from-blue-600 to-indigo-600 progress-bar-animate" style="width: 20%"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- 메인 콘텐츠 -->
  <div class="max-w-2xl mx-auto px-4 py-8">
    <!-- 인사말 -->
    <div class="text-center mb-8 fade-in">
      <div class="inline-block p-3 bg-blue-100 rounded-2xl mb-4">
        <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
      </div>
      <h1 class="text-3xl font-bold text-gray-900 mb-2">누수일때, 누수체크!</h1>
      <p class="text-gray-600">검증된 전문가를 바로 매칭해드려요</p>
    </div>

    <!-- 신뢰 배지 -->
    <div class="mb-8 bg-white rounded-2xl p-4 border border-gray-200 shadow-sm">
      <div class="flex items-center justify-center gap-6 text-xs text-gray-600">
        <div class="flex items-center gap-1">
          <svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
          </svg>
          <span>평균 2시간 배정</span>
        </div>
        <div class="flex items-center gap-1">
          <svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
          </svg>
          <span>검증된 전문가</span>
        </div>
        <div class="flex items-center gap-1">
          <svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
          </svg>
          <span>투명한 견적</span>
        </div>
      </div>
    </div>

    <!-- 폼 -->
    <%= form_with(model: @request, url: customers_requests_path,
                  html: { multipart: true, class: "space-y-6" },
                  data: { controller: "button-loading", action: "submit->button-loading#submit" }) do |f| %>

      <%= render "shared/form_errors", resource: @request %>

      <!-- 단계별 인디케이터 -->
      <div class="flex justify-between mb-8">
        <% ["증상", "위치", "상황", "자료", "확인"].each_with_index do |label, index| %>
          <div class="flex flex-col items-center cursor-pointer" data-step-indicator data-step="<%= index + 1 %>" data-action="click->insurance-step#goToStep">
            <div class="step-circle w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold mb-1 <%= index == 0 ? 'bg-blue-600 text-white' : 'bg-gray-300 text-gray-600' %>">
              <%= index + 1 %>
            </div>
            <span class="step-label text-xs text-center <%= index == 0 ? 'text-blue-600 font-semibold' : 'text-gray-600' %>"><%= label %></span>
          </div>
        <% end %>
      </div>

      <!-- 단계 1: 증상 정보 -->
      <div data-insurance-step-target="step" class="bg-white rounded-3xl shadow-sm border border-gray-200 p-8">
        <div class="mb-6">
          <h2 class="text-2xl font-bold text-gray-900 mb-2">어떤 증상인가요?</h2>
          <p class="text-gray-600">가장 비슷한 증상을 선택해주세요</p>
        </div>

        <div class="space-y-6">
          <div>
            <%= f.label :symptom_type, "증상 선택", class: "block text-sm font-semibold text-gray-900 mb-2" %>
            <%= f.select :symptom_type,
                  options_for_select([
                    ["선택해 주세요", ""],
                    ["💧 벽면 누수 (벽에서 물이 배어나와요)", "wall_leak"],
                    ["💧 천장 누수 (천장에서 물이 떨어져요)", "ceiling_leak"],
                    ["💧 바닥 누수 (바닥이 축축해요)", "floor_leak"],
                    ["🔧 배관 누수 (배관에서 새는 것 같아요)", "pipe_leak"],
                    ["🚽 화장실 누수 (화장실에서 물이 새요)", "toilet_leak"],
                    ["🏠 외부 누수 (외벽, 창틀에서 새요)", "outdoor_leak"]
                  ], @request.symptom_type),
                  {},
                  required: true,
                  data: { action: "input->insurance-step#validateInput" },
                  class: "w-full px-4 py-4 text-lg border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" %>
          </div>

          <div>
            <%= f.label :building_type, "건물 종류는?", class: "block text-sm font-semibold text-gray-900 mb-2" %>
            <p class="text-xs text-gray-500 mb-2">건물에 맞는 전문가를 매칭해드려요</p>
            <%= f.select :building_type,
                  options_for_select([
                    ["선택해 주세요", ""],
                    ["🏢 아파트", "apartment"],
                    ["🏘️ 빌라/연립", "villa"],
                    ["🏠 단독주택", "house"],
                    ["🏬 사무실", "office"],
                    ["🏪 상가", "store"],
                    ["🏭 공장", "factory"],
                    ["📦 기타", "other_building"]
                  ], @request.building_type),
                  {},
                  required: true,
                  data: { action: "input->insurance-step#validateInput" },
                  class: "w-full px-4 py-4 text-lg border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" %>
          </div>
        </div>
      </div>

      <!-- 단계 2: 위치 정보 -->
      <div data-insurance-step-target="step" class="hidden bg-white rounded-3xl shadow-sm border border-gray-200 p-8">
        <div class="mb-6">
          <h2 class="text-2xl font-bold text-gray-900 mb-2">어디로 방문하면 될까요?</h2>
          <p class="text-gray-600">정확한 주소를 알려주세요</p>
        </div>

        <div class="space-y-6">
          <div>
            <%= f.label :address, "주소", class: "block text-sm font-semibold text-gray-900 mb-2" %>
            <%= f.text_field :address,
                  placeholder: "서울시 강남구 테헤란로 123",
                  required: true,
                  data: { action: "input->insurance-step#validateInput" },
                  class: "w-full px-4 py-4 text-lg border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" %>
          </div>

          <div>
            <%= f.label :detailed_address, "상세 주소 (동/호수)", class: "block text-sm font-semibold text-gray-900 mb-2" %>
            <%= f.text_field :detailed_address,
                  placeholder: "101동 502호",
                  class: "w-full px-4 py-4 text-lg border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" %>
            <p class="text-xs text-gray-500 mt-2">정확할수록 빠르게 찾아갈 수 있어요</p>
          </div>

          <div>
            <%= f.label :floor, "층수 (선택)", class: "block text-sm font-semibold text-gray-900 mb-2" %>
            <%= f.text_field :floor,
                  placeholder: "5층",
                  class: "w-full px-4 py-4 text-lg border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" %>
            <p class="text-xs text-gray-500 mt-2">층수 정보가 있으면 원인 파악에 도움이 돼요</p>
          </div>
        </div>
      </div>

      <!-- 단계 3: 상황 설명 -->
      <div data-insurance-step-target="step" class="hidden bg-white rounded-3xl shadow-sm border border-gray-200 p-8">
        <div class="mb-6">
          <h2 class="text-2xl font-bold text-gray-900 mb-2">어떤 상황인가요?</h2>
          <p class="text-gray-600">자세히 알려주실수록 정확한 진단이 가능해요</p>
        </div>

        <div class="space-y-6">
          <div>
            <%= f.label :description, "상황 설명 (선택)", class: "block text-sm font-semibold text-gray-900 mb-2" %>
            <%= f.text_area :description,
                  rows: 6,
                  placeholder: "예시:\n일주일 전부터 천장에 물방울이 떨어지기 시작했어요.\n처음에는 조금씩이었는데 점점 심해지고 있습니다.\n아직 벽지가 들뜨지는 않았지만 천장에 물자국이 생겼어요.",
                  class: "w-full px-4 py-4 text-base border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition resize-none" %>
            <p class="text-xs text-gray-500 mt-2">💡 언제부터, 얼마나 심한지 알려주세요</p>
          </div>

          <div>
            <%= f.label :preferred_date, "방문 희망 일시 (선택)", class: "block text-sm font-semibold text-gray-900 mb-2" %>
            <%= f.datetime_local_field :preferred_date,
                  min: DateTime.now.strftime("%Y-%m-%dT%H:%M"),
                  class: "w-full px-4 py-4 text-lg border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" %>
            <p class="text-xs text-gray-500 mt-2">급하시면 빈칸으로 두셔도 돼요. 최대한 빨리 연락드릴게요</p>
          </div>
        </div>
      </div>

      <!-- 단계 4: 자료 첨부 -->
      <div data-insurance-step-target="step" class="hidden bg-white rounded-3xl shadow-sm border border-gray-200 p-8">
        <div class="mb-6">
          <h2 class="text-2xl font-bold text-gray-900 mb-2">사진이나 영상이 있나요?</h2>
          <p class="text-gray-600">10초 이상 영상이 가장 효과적이에요</p>
        </div>

        <div class="space-y-6">
          <!-- 영상 업로드 -->
          <div>
            <div class="flex items-center gap-2 mb-3">
              <%= f.label :videos, "영상 업로드", class: "block text-sm font-semibold text-gray-900" %>
              <span class="px-2 py-0.5 bg-blue-600 text-white text-xs font-bold rounded-full">추천</span>
            </div>

            <div class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-2xl">
              <p class="font-bold text-blue-900 text-sm flex items-center gap-2 mb-2">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"/>
                </svg>
                영상이 사진보다 훨씬 효과적이에요!
              </p>
              <p class="text-blue-700 text-xs leading-relaxed">
                10초 이상의 영상을 올려주시면 누수 위치·범위·심각도를 훨씬 정확하게 파악할 수 있어요.
                물 흐르는 소리, 번지는 범위, 물방울 패턴 등 사진으로는 담기 어려운 정보가 담겨 진단 정확도가 크게 높아집니다.
              </p>
            </div>

            <div class="border-2 border-dashed border-blue-300 rounded-2xl p-8 text-center hover:border-blue-500 bg-blue-50/30 transition-all cursor-pointer">
              <%= f.file_field :videos,
                    multiple: true,
                    accept: "video/mp4,video/quicktime,video/avi,video/webm,video/3gpp",
                    class: "hidden",
                    id: "video-upload" %>
              <label for="video-upload" class="cursor-pointer">
                <div class="inline-block p-4 bg-blue-100 rounded-2xl mb-4">
                  <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"/>
                  </svg>
                </div>
                <p class="text-lg font-semibold text-gray-900 mb-1">영상을 여기에 놓거나 클릭하세요</p>
                <p class="text-sm text-gray-500">MP4, MOV · 최대 500MB · 10초 이상 권장</p>
              </label>
            </div>

            <div class="mt-3 p-3 bg-yellow-50 rounded-lg text-xs text-gray-700">
              <p class="font-semibold mb-1">🎬 이렇게 찍으면 좋아요</p>
              <ul class="space-y-1">
                <li>• 누수 부위를 10초 이상 촬영해주세요</li>
                <li>• 물이 흐르거나 스며드는 모습을 연속으로 담아주세요</li>
                <li>• 주변 환경까지 보이도록 천천히 이동하며 찍어주세요</li>
              </ul>
            </div>
          </div>

          <!-- 사진 업로드 -->
          <div>
            <%= f.label :photos, "사진 업로드 (추가)", class: "block text-sm font-semibold text-gray-900 mb-2" %>
            <p class="text-xs text-gray-600 mb-3">영상과 함께 사진도 올려주시면 더욱 좋아요</p>

            <div class="border-2 border-dashed border-gray-300 rounded-2xl p-8 text-center hover:border-gray-400 transition-all cursor-pointer">
              <%= f.file_field :photos,
                    multiple: true,
                    accept: "image/*",
                    class: "hidden",
                    id: "photo-upload" %>
              <label for="photo-upload" class="cursor-pointer">
                <div class="inline-block p-4 bg-gray-100 rounded-2xl mb-4">
                  <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                  </svg>
                </div>
                <p class="text-lg font-semibold text-gray-900 mb-1">사진을 여기에 놓거나 클릭하세요</p>
                <p class="text-sm text-gray-500">JPG, PNG · 최대 5장 · 각 50MB</p>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- 단계 5: 확인 및 제출 -->
      <div data-insurance-step-target="step" class="hidden bg-white rounded-3xl shadow-sm border border-gray-200 p-8">
        <div class="mb-6 text-center">
          <div class="inline-block p-4 bg-green-100 rounded-2xl mb-4">
            <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
          </div>
          <h2 class="text-2xl font-bold text-gray-900 mb-2">전문가 매칭 준비 완료!</h2>
          <p class="text-gray-600">접수하시면 즉시 전문가를 찾아드려요</p>
        </div>

        <div class="space-y-4">
          <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-100">
            <h3 class="font-semibold text-gray-900 mb-3 flex items-center gap-2">
              <span class="text-xl">⚡</span>
              이렇게 빠르게 진행돼요
            </h3>
            <ol class="space-y-2 text-sm text-gray-700">
              <li class="flex gap-2">
                <span class="font-bold text-blue-600">1.</span>
                <span>접수하시면 <strong>즉시 전문가 매칭</strong></span>
              </li>
              <li class="flex gap-2">
                <span class="font-bold text-blue-600">2.</span>
                <span>평균 <strong>2시간 이내 전문가 배정</strong></span>
              </li>
              <li class="flex gap-2">
                <span class="font-bold text-blue-600">3.</span>
                <span><strong>24시간 이내 현장 방문</strong> 가능</span>
              </li>
              <li class="flex gap-2">
                <span class="font-bold text-blue-600">4.</span>
                <span>정밀 진단 후 <strong>투명한 견적</strong> 제공</span>
              </li>
            </ol>
          </div>

          <div class="bg-gradient-to-br from-gray-50 to-slate-50 rounded-2xl p-6 border border-gray-200">
            <h3 class="font-semibold text-gray-900 mb-3">✅ 안심하세요</h3>
            <ul class="space-y-2 text-sm text-gray-700">
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-green-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span><strong>검증된 전문가</strong>만 활동해요</span>
              </li>
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-green-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span><strong>에스크로 안전 결제</strong>로 보호돼요</span>
              </li>
              <li class="flex items-start gap-2">
                <svg class="w-4 h-4 text-green-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span><strong>하자보수 보증</strong>이 포함돼 있어요</span>
              </li>
            </ul>
          </div>

          <div class="p-4 bg-yellow-50 rounded-xl border border-yellow-200">
            <p class="text-sm text-yellow-900 flex items-start gap-2">
              <svg class="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
              <span><strong>예상 비용</strong>: 탐지 10~15만원, 수리 30만원부터 (현장 상황에 따라 달라져요)</span>
            </p>
          </div>
        </div>
      </div>

      <!-- 네비게이션 버튼 -->
      <div class="flex justify-between gap-3 mt-8">
        <button type="button"
                data-insurance-step-target="prevBtn"
                data-action="click->insurance-step#prev"
                class="hidden px-6 py-4 rounded-xl font-semibold text-gray-700 bg-white border-2 border-gray-300 hover:bg-gray-50 transition-all">
          ← 이전
        </button>

        <button type="button"
                data-insurance-step-target="nextBtn"
                data-action="click->insurance-step#next"
                class="ml-auto px-8 py-4 rounded-xl font-bold text-white bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 transition-all shadow-lg hover:shadow-xl">
          다음 →
        </button>

        <button type="submit"
                data-insurance-step-target="submitBtn"
                data-button-loading-target="button"
                data-button-loading-loading-text-value="매칭하는 중..."
                class="hidden ml-auto px-8 py-4 rounded-xl font-bold text-white bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 transition-all shadow-lg hover:shadow-xl inline-flex items-center gap-2">
          <span data-button-loading-target="spinner" class="btn-spinner hidden"></span>
          <span data-button-loading-target="text">🚀 전문가 매칭받기</span>
        </button>
      </div>

      <p class="text-xs text-center text-gray-500 mt-4">평균 2시간 이내에 전문가가 배정돼요</p>
    <% end %>
  </div>
</div>
