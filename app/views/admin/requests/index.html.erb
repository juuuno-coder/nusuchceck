<div class="space-y-6">
  <h1 class="text-2xl font-bold text-gray-900">전체 신고 관리</h1>

  <!-- 검색/필터 -->
  <div class="bg-white rounded-lg shadow p-4">
    <%= search_form_for @q, url: admin_requests_path, html: { method: :get, class: "flex flex-col sm:flex-row gap-3" } do |f| %>
      <div class="flex-1">
        <%= f.search_field :customer_name_or_address_cont,
              placeholder: "고객명 또는 주소 검색...",
              class: "w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm" %>
      </div>
      <div class="flex-1">
        <%= f.select :status_eq,
              options_for_select([
                ["전체 상태", ""],
                ["접수됨", "reported"],
                ["마스터 배정", "assigned"],
                ["방문 중", "visiting"],
                ["탐지 중", "detecting"],
                ["누수 미확인", "no_leak_found"],
                ["견적 대기", "estimate_pending"],
                ["견적 제출", "estimate_submitted"],
                ["공사 합의", "construction_agreed"],
                ["에스크로 입금", "escrow_deposited"],
                ["공사 진행", "constructing"],
                ["공사 완료", "construction_completed"],
                ["종료", "closed"],
                ["취소", "cancelled"]
              ], params.dig(:q, :status_eq)),
              {}, class: "w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm" %>
      </div>
      <div class="flex gap-2">
        <%= f.submit "검색", class: "px-4 py-2 bg-gray-800 text-white rounded-md hover:bg-gray-900 text-sm font-medium cursor-pointer" %>
        <%= link_to "초기화", admin_requests_path, class: "px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 text-sm font-medium" %>
      </div>
    <% end %>
  </div>

  <!-- 테이블 -->
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">접수번호</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">고객</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">마스터</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">증상</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">상태</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">접수일</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          <%
            symptom_labels = {
              "wall_leak" => "벽면 누수", "ceiling_leak" => "천장 누수",
              "floor_leak" => "바닥 누수", "pipe_leak" => "배관 누수",
              "toilet_leak" => "화장실 누수", "outdoor_leak" => "외부 누수"
            }
          %>
          <% @requests.each do |request| %>
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap">
                <%= link_to "##{request.id}", admin_request_path(request), class: "text-blue-600 hover:text-blue-800 font-mono text-sm font-medium" %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= request.customer&.name || "-" %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600"><%= request.master&.name || "-" %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600"><%= symptom_labels[request.symptom_type] || request.symptom_type %></td>
              <td class="px-6 py-4 whitespace-nowrap"><%= render "shared/status_badge", status: request.status %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><%= request.created_at.strftime("%Y-%m-%d %H:%M") %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- 페이지네이션 -->
  <div class="mt-6">
    <%= paginate @requests %>
  </div>
</div>
