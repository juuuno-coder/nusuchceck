<div class="max-w-2xl mx-auto py-8">
  <div class="text-center mb-8">
    <h1 class="text-3xl font-bold text-gray-900">💼 보험청구서 작성</h1>
    <p class="mt-3 text-lg text-gray-600">고객을 위해 보험청구서를 작성해주세요</p>
    <p class="text-gray-600">전문가가 작성하면 승인률이 높아져요</p>
    <% if @insurance_claim.request.present? %>
      <div class="mt-4 inline-flex items-center gap-2 px-4 py-2 bg-blue-50 rounded-full text-sm text-blue-700 font-medium">
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
        </svg>
        신고(NSC-<%= @insurance_claim.request.id.to_s.rjust(6, '0') %>)에서 정보가 자동으로 채워졌어요
      </div>
    <% end %>
  </div>

  <!-- 절차 안내 -->
  <div class="mb-8 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-100">
    <h3 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
      <span class="text-xl">📋</span>
      이렇게 진행돼요
    </h3>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <div class="bg-white rounded-xl p-4">
        <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold mb-2">1</div>
        <p class="font-semibold text-gray-900 text-sm">청구서 작성</p>
        <p class="text-xs text-gray-600 mt-1">견적서와 영수증 첨부</p>
      </div>
      <div class="bg-white rounded-xl p-4">
        <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold mb-2">2</div>
        <p class="font-semibold text-gray-900 text-sm">고객에게 전송</p>
        <p class="text-xs text-gray-600 mt-1">검토 요청 알림 발송</p>
      </div>
      <div class="bg-white rounded-xl p-4">
        <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold mb-2">3</div>
        <p class="font-semibold text-gray-900 text-sm">고객 검토</p>
        <p class="text-xs text-gray-600 mt-1">고객이 내용 확인</p>
      </div>
      <div class="bg-white rounded-xl p-4">
        <div class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold mb-2">4</div>
        <p class="font-semibold text-gray-900 text-sm">자동 제출</p>
        <p class="text-xs text-gray-600 mt-1">승인 시 보험사 접수</p>
      </div>
    </div>
    <div class="mt-4 pt-4 border-t border-blue-200 text-sm">
      <p class="font-semibold text-gray-900 mb-2">💡 꼭 첨부해야 할 서류</p>
      <ul class="text-gray-700 space-y-1 text-xs">
        <li>• 공사 견적서 또는 영수증 (필수)</li>
        <li>• 누수 현장 사진 (시공 전/후)</li>
        <li>• 수리 완료 확인서</li>
        <li>• 아래층 피해 확인서 (제3자 피해가 있는 경우)</li>
      </ul>
    </div>
  </div>

  <div class="mb-4">
    <%= link_to masters_insurance_claims_path, class: "text-sm text-blue-600 hover:text-blue-800 flex items-center" do %>
      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      목록으로
    <% end %>
  </div>

  <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
    <%= form_with(model: [:masters, @insurance_claim],
                  url: masters_request_insurance_claims_path(@insurance_claim.request),
                  html: { multipart: true }, class: "space-y-6") do |f| %>

      <%= render "shared/form_errors", resource: @insurance_claim %>

      <% if @insurance_claim.request.present? %>
        <%= f.hidden_field :request_id, value: @insurance_claim.request.id %>
      <% end %>

      <!-- 섹션 1: 고객 정보 -->
      <fieldset class="space-y-4">
        <legend class="text-lg font-semibold text-gray-900 border-b pb-2 w-full flex items-center gap-2">
          <span>👤</span>
          <span>고객 정보</span>
        </legend>
        <p class="text-xs text-gray-600">신고 정보에서 자동으로 채워졌어요</p>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <%= f.label :applicant_name, "성명 *", class: "block text-sm font-medium text-gray-900 mb-1" %>
            <%= f.text_field :applicant_name, required: true,
                  placeholder: "홍길동",
                  class: input_classes(:text) %>
          </div>
          <div>
            <%= f.label :applicant_phone, "연락처 *", class: "block text-sm font-medium text-gray-900 mb-1" %>
            <%= f.text_field :applicant_phone, required: true, placeholder: "010-1234-5678",
                  class: input_classes(:text) %>
            <p class="text-xs text-gray-500 mt-1">보험사 연락용</p>
          </div>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <%= f.label :applicant_email, "이메일", class: "block text-sm font-medium text-gray-900 mb-1" %>
            <%= f.email_field :applicant_email,
                  placeholder: "example@email.com",
                  class: input_classes(:text) %>
            <p class="text-xs text-gray-500 mt-1">진행 알림용 (선택)</p>
          </div>
          <div>
            <%= f.label :birth_date, "생년월일", class: "block text-sm font-medium text-gray-900 mb-1" %>
            <%= f.date_field :birth_date,
                  class: input_classes(:text) %>
            <p class="text-xs text-gray-500 mt-1">본인 확인용 (선택)</p>
          </div>
        </div>
      </fieldset>

      <!-- 섹션 2: 사고 정보 -->
      <fieldset class="space-y-4">
        <legend class="text-lg font-semibold text-gray-900 border-b pb-2 w-full flex items-center gap-2">
          <span>🚨</span>
          <span>사고 정보</span>
        </legend>
        <p class="text-xs text-gray-600">정확한 정보를 입력해주세요</p>
        <div>
          <%= f.label :incident_date, "사고 발생일 *", class: "block text-sm font-medium text-gray-900 mb-1" %>
          <%= f.date_field :incident_date, required: true,
                max: Date.today,
                class: input_classes(:text) %>
          <p class="text-xs text-gray-500 mt-1">고객이 처음 누수를 발견한 날짜</p>
        </div>
        <div>
          <%= f.label :incident_address, "사고 장소 *", class: "block text-sm font-medium text-gray-900 mb-1" %>
          <%= f.text_field :incident_address, required: true,
                placeholder: "서울시 강남구 테헤란로 123",
                class: input_classes(:text) %>
        </div>
        <div>
          <%= f.label :incident_detail_address, "상세 주소", class: "block text-sm font-medium text-gray-900 mb-1" %>
          <%= f.text_field :incident_detail_address,
                placeholder: "101동 1234호",
                class: input_classes(:text) %>
        </div>
        <div>
          <%= f.label :damage_type, "피해 유형 *", class: "block text-sm font-medium text-gray-900 mb-1" %>
          <%= f.select :damage_type,
                options_for_select([
                  ["재산 피해 (물건, 집기 등)", "property_damage"],
                  ["인적 피해 (사람이 다침)", "personal_injury"],
                  ["재산 + 인적 피해", "both"]
                ], @insurance_claim.damage_type),
                { include_blank: "선택해 주세요" },
                class: input_classes(:select) %>
          <p class="text-xs text-gray-500 mt-1">대부분 재산 피해예요</p>
        </div>
        <div>
          <%= f.label :estimated_damage_amount, "실제 공사 금액 *", class: "block text-sm font-medium text-gray-900 mb-1" %>
          <%= f.number_field :estimated_damage_amount, min: 0, step: 10000,
                required: true,
                placeholder: "500000",
                class: input_classes(:text) %>
          <p class="text-xs text-gray-500 mt-1">💡 견적서/영수증의 금액과 일치해야 해요</p>
        </div>
        <div>
          <%= f.label :incident_description, "사고 내용 상세 *", class: "block text-sm font-medium text-gray-900 mb-1" %>
          <%= f.text_area :incident_description, rows: 6, required: true,
                placeholder: "예시:\n2024년 1월 15일, 화장실 배관에서 누수가 발생하여 아래층 천장과 벽지가 훼손되었습니다.\n긴급 수리를 진행하여 배관 교체 및 방수 작업을 완료하였으며,\n아래층 천장 도배 및 페인트 작업도 함께 진행하였습니다.\n\n- 수리 항목: 배관 교체, 방수 처리, 천장 도배, 벽면 페인트\n- 수리 기간: 2024.01.16 ~ 2024.01.20\n- 총 공사비: 500,000원",
                class: input_classes(:textarea) %>
          <p class="text-xs text-gray-500 mt-1">사고 원인, 수리 내용, 공사 기간을 자세히 적어주세요</p>
        </div>
      </fieldset>

      <!-- 섹션 3: 보험 정보 -->
      <fieldset class="space-y-4">
        <legend class="text-lg font-semibold text-gray-900 border-b pb-2 w-full flex items-center gap-2">
          <span>🛡️</span>
          <span>보험 정보</span>
          <span class="text-xs font-normal text-gray-500">(선택사항)</span>
        </legend>
        <p class="text-xs text-gray-600">고객이 가입한 보험이 있다면 입력해주세요</p>
        <div class="px-4 py-3 bg-blue-50 rounded-lg text-sm text-blue-700">
          <p class="flex items-start gap-2">
            <svg class="w-4 h-4 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
            </svg>
            <span>모르면 비워두셔도 돼요. 나중에 추가할 수 있어요</span>
          </p>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <%= f.label :insurance_company, "보험사", class: "block text-sm font-medium text-gray-900 mb-1" %>
            <%= f.select :insurance_company,
                  options_for_select(
                    ["삼성화재", "현대해상", "DB손해보험", "KB손해보험",
                     "메리츠화재", "한화손해보험", "흥국화재", "기타"],
                    @insurance_claim.insurance_company
                  ),
                  { include_blank: "선택해 주세요" },
                  class: input_classes(:select) %>
          </div>
          <div>
            <%= f.label :policy_number, "증권번호", class: "block text-sm font-medium text-gray-900 mb-1" %>
            <%= f.text_field :policy_number,
                  placeholder: "12345678-01-001",
                  class: input_classes(:text) %>
            <p class="text-xs text-gray-500 mt-1">보험증권에서 확인</p>
          </div>
        </div>
      </fieldset>

      <!-- 섹션 4: 피해자(제3자) 정보 -->
      <fieldset class="space-y-4">
        <legend class="text-lg font-semibold text-gray-900 border-b pb-2 w-full flex items-center gap-2">
          <span>👥</span>
          <span>피해자 정보</span>
          <span class="text-xs font-normal text-gray-500">(선택사항)</span>
        </legend>
        <p class="text-xs text-gray-600">아래층 등 제3자가 피해를 입었다면 입력해주세요</p>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <%= f.label :victim_name, "피해자 성명", class: "block text-sm font-medium text-gray-900 mb-1" %>
            <%= f.text_field :victim_name,
                  placeholder: "홍길동",
                  class: input_classes(:text) %>
          </div>
          <div>
            <%= f.label :victim_phone, "피해자 연락처", class: "block text-sm font-medium text-gray-900 mb-1" %>
            <%= f.text_field :victim_phone,
                  placeholder: "010-1234-5678",
                  class: input_classes(:text) %>
          </div>
        </div>
        <div>
          <%= f.label :victim_address, "피해자 주소", class: "block text-sm font-medium text-gray-900 mb-1" %>
          <%= f.text_area :victim_address, rows: 2,
                placeholder: "피해를 입은 분의 주소를 입력하세요",
                class: input_classes(:textarea) %>
        </div>
      </fieldset>

      <!-- 섹션 5: 증빙 서류 -->
      <fieldset class="space-y-4">
        <legend class="text-lg font-semibold text-gray-900 border-b pb-2 w-full flex items-center gap-2">
          <span>📎</span>
          <span>증빙 서류 *</span>
          <span class="text-xs font-normal text-red-600">(필수)</span>
        </legend>
        <p class="text-xs text-gray-600">반드시 견적서/영수증을 첨부해주세요</p>
        <div class="px-4 py-3 bg-yellow-50 rounded-lg text-sm text-gray-700">
          <p class="font-semibold mb-2">📋 반드시 첨부해야 할 서류</p>
          <ul class="text-xs space-y-1">
            <li>• ✅ <strong>견적서 또는 영수증</strong> (필수 - 공사 금액 증빙)</li>
            <li>• ✅ <strong>현장 사진</strong> (필수 - 수리 전/후 사진)</li>
            <li>• 수리 완료 확인서 (권장)</li>
            <li>• 피해 확인서 (아래층 피해가 있는 경우)</li>
          </ul>
        </div>
        <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-blue-400 transition">
          <%= f.file_field :supporting_documents, multiple: true, accept: "image/*,application/pdf",
                required: true,
                class: "w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700 file:cursor-pointer cursor-pointer" %>
          <p class="mt-2 text-xs text-gray-500">사진, PDF 파일 · 최대 10개 · 각 파일당 10MB 이하</p>
        </div>
        <p class="text-xs text-red-600 font-medium">⚠️ 견적서/영수증이 없으면 보험사 심사가 거부될 수 있어요</p>
      </fieldset>

      <!-- 제출 -->
      <div class="pt-6 border-t-2 border-gray-200">
        <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-5 mb-4 border border-green-100">
          <p class="text-sm text-gray-800 flex items-start gap-2">
            <svg class="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            <span><strong>임시 저장</strong> 후 고객에게 검토 요청을 보낼 수 있어요</span>
          </p>
        </div>
        <div class="flex items-center justify-end gap-3">
          <%= link_to "취소", masters_insurance_claims_path,
                class: "px-5 py-2.5 rounded-lg font-medium text-gray-700 hover:bg-gray-100 transition" %>
          <%= f.submit "💾 임시 저장하기",
                class: "px-8 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition shadow-lg hover:shadow-xl" %>
        </div>
        <p class="text-xs text-center text-gray-500 mt-3">저장 후 내용을 확인하고 고객에게 보낼 수 있어요</p>
      </div>
    <% end %>
  </div>
</div>
