FROM ruby:3.2.2-slim

WORKDIR /app

# 시스템 패키지 설치
RUN apt-get update -qq && \
    apt-get install --no-install-recommends -y \
      build-essential \
      git \
      curl \
      libpq-dev \
      libvips \
      postgresql-client \
    && rm -rf /var/lib/apt/lists/*

# Bundler 설치
RUN gem install bundler

# Gemfile 복사 및 의존성 설치
COPY Gemfile ./
RUN bundle lock --add-platform x86_64-linux && \
    bundle install --jobs 4

# Tailwind CSS 바이너리는 tailwindcss-rails gem이 자동 포함

EXPOSE 3000

CMD ["bin/rails", "server", "-b", "0.0.0.0"]
