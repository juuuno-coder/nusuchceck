<div class="max-w-2xl mx-auto">
  <div class="mb-6">
    <%= link_to customers_insurance_claim_path(@insurance_claim), class: "text-sm text-blue-600 hover:text-blue-800 flex items-center" do %>
      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      돌아가기
    <% end %>
    <h1 class="text-2xl font-bold text-gray-900 mt-2">보험 신청서 수정</h1>
    <span class="text-sm font-mono text-gray-500"><%= @insurance_claim.claim_number %></span>
  </div>

  <div class="bg-white rounded-lg shadow p-6">
    <%= form_with(model: [:customers, @insurance_claim],
                  html: { multipart: true }, class: "space-y-6") do |f| %>

      <% if @insurance_claim.errors.any? %>
        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
          <p class="text-sm text-red-700 font-medium">입력 오류가 있습니다:</p>
          <ul class="mt-1 text-sm text-red-600 list-disc list-inside">
            <% @insurance_claim.errors.full_messages.each do |msg| %>
              <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <!-- 신청자 정보 -->
      <fieldset class="space-y-4">
        <legend class="text-lg font-semibold text-gray-900 border-b pb-2 w-full">신청자 정보</legend>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <%= f.label :applicant_name, "성명 *", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :applicant_name, required: true,
                  class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
          </div>
          <div>
            <%= f.label :applicant_phone, "연락처 *", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :applicant_phone, required: true,
                  class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
          </div>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <%= f.label :applicant_email, "이메일", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.email_field :applicant_email,
                  class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
          </div>
          <div>
            <%= f.label :birth_date, "생년월일", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.date_field :birth_date,
                  class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
          </div>
        </div>
      </fieldset>

      <!-- 사고 정보 -->
      <fieldset class="space-y-4">
        <legend class="text-lg font-semibold text-gray-900 border-b pb-2 w-full">사고 정보</legend>
        <div>
          <%= f.label :incident_date, "사고 발생일 *", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.date_field :incident_date, required: true,
                class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
        </div>
        <div>
          <%= f.label :incident_address, "사고 장소 *", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.text_field :incident_address, required: true,
                class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
        </div>
        <div>
          <%= f.label :incident_detail_address, "상세 주소", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.text_field :incident_detail_address,
                class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
        </div>
        <div>
          <%= f.label :damage_type, "피해 유형", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.select :damage_type,
                options_for_select([
                  ["재산 피해", "property_damage"],
                  ["인적 피해", "personal_injury"],
                  ["재산 + 인적 피해", "both"]
                ], @insurance_claim.damage_type),
                { include_blank: "선택해 주세요" },
                class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
        </div>
        <div>
          <%= f.label :estimated_damage_amount, "예상 피해 금액 (원)", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.number_field :estimated_damage_amount, min: 0, step: 10000,
                class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
        </div>
        <div>
          <%= f.label :incident_description, "사고 내용 상세 *", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.text_area :incident_description, rows: 5, required: true,
                class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
        </div>
      </fieldset>

      <!-- 보험 정보 -->
      <fieldset class="space-y-4">
        <legend class="text-lg font-semibold text-gray-900 border-b pb-2 w-full">보험 정보</legend>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <%= f.label :insurance_company, "보험사", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.select :insurance_company,
                  options_for_select(
                    ["삼성화재", "현대해상", "DB손해보험", "KB손해보험",
                     "메리츠화재", "한화손해보험", "흥국화재", "기타"],
                    @insurance_claim.insurance_company
                  ),
                  { include_blank: "선택해 주세요" },
                  class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
          </div>
          <div>
            <%= f.label :policy_number, "증권번호", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :policy_number,
                  class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
          </div>
        </div>
      </fieldset>

      <!-- 피해자 정보 -->
      <fieldset class="space-y-4">
        <legend class="text-lg font-semibold text-gray-900 border-b pb-2 w-full">
          피해자(제3자) 정보 <span class="text-sm font-normal text-gray-500">(선택)</span>
        </legend>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <%= f.label :victim_name, "피해자 성명", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :victim_name,
                  class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
          </div>
          <div>
            <%= f.label :victim_phone, "피해자 연락처", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :victim_phone,
                  class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
          </div>
        </div>
        <div>
          <%= f.label :victim_address, "피해자 주소", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.text_area :victim_address, rows: 2,
                class: "w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
        </div>
      </fieldset>

      <!-- 증빙 서류 -->
      <fieldset class="space-y-4">
        <legend class="text-lg font-semibold text-gray-900 border-b pb-2 w-full">증빙 서류 추가</legend>
        <div>
          <%= f.file_field :supporting_documents, multiple: true, accept: "image/*,application/pdf",
                class: "w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" %>
        </div>
      </fieldset>

      <div class="flex items-center justify-end gap-3 pt-4 border-t">
        <%= link_to "취소", customers_insurance_claim_path(@insurance_claim),
              class: "px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-medium text-sm" %>
        <%= f.submit "저장",
              class: "px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium text-sm cursor-pointer" %>
      </div>
    <% end %>
  </div>
</div>
