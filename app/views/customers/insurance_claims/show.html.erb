<div class="max-w-3xl mx-auto py-8">
  <!-- μƒλ‹¨ -->
  <div class="mb-6">
    <%= link_to customers_insurance_claims_path, class: "text-sm text-blue-600 hover:text-blue-800 flex items-center mb-3" do %>
      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      λ©λ΅μΌλ΅
    <% end %>
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-bold text-gray-900">π’Ό λ³΄ν— μ‹ μ²­μ„</h1>
        <span class="text-sm font-mono text-gray-500"><%= @insurance_claim.claim_number %></span>
      </div>
      <span class="px-4 py-2 rounded-full text-sm font-semibold
        <%= case @insurance_claim.status
            when 'draft' then 'bg-gray-100 text-gray-700'
            when 'submitted' then 'bg-blue-100 text-blue-700'
            when 'under_review' then 'bg-yellow-100 text-yellow-700'
            when 'approved' then 'bg-green-100 text-green-700'
            when 'rejected' then 'bg-red-100 text-red-700'
            when 'completed' then 'bg-purple-100 text-purple-700'
            end %>">
        <%= @insurance_claim.status_label %>
      </span>
    </div>
  </div>

  <!-- μ „λ¬Έκ°€ μ‘μ„± μ •λ³΄ -->
  <% if @insurance_claim.prepared_by_master? %>
    <div class="mb-6 bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-4 border border-purple-100">
      <div class="flex items-center gap-2 text-sm">
        <span class="text-lg">π‘¨β€π”§</span>
        <span class="font-semibold text-gray-900">μ „λ¬Έκ°€κ°€ λ€μ‹  μ‘μ„±ν• μ‹ μ²­μ„μμ”</span>
        <span class="text-gray-600">β€Ά μ‘μ„±μ: <%= @insurance_claim.prepared_by_master.name %></span>
      </div>
    </div>
  <% end %>

  <!-- μƒνƒλ³„ μ•λ‚΄ λ©”μ‹μ§€ -->
  <% case @insurance_claim.status %>
  <% when 'pending_customer_review' %>
    <div class="mb-6 bg-gradient-to-r from-yellow-50 to-amber-50 rounded-2xl p-6 border-l-4 border-yellow-500">
      <div class="flex items-start gap-3">
        <span class="text-3xl">π“‹</span>
        <div class="flex-1">
          <h3 class="font-bold text-gray-900 text-lg mb-1">μ „λ¬Έκ°€κ°€ μ‘μ„±ν• λ³΄ν—μ²­κµ¬μ„λ¥Ό ν™•μΈν•΄μ£Όμ„Έμ”</h3>
          <p class="text-gray-700 text-sm mb-3">λ‚΄μ©μ„ κ²€ν† ν•μ‹  ν›„ <strong>μΉμΈ</strong>ν•μ‹λ©΄ μλ™μΌλ΅ λ³΄ν—μ‚¬μ— μ μ¶λΌμ”</p>
          <div class="text-xs text-gray-600 space-y-1">
            <p>β… μΉμΈν•λ©΄ μ¦‰μ‹ λ³΄ν—μ‚¬μ— μ ‘μλΌμ”</p>
            <p>βοΈ μμ •μ΄ ν•„μ”ν•λ©΄ μ „λ¬Έκ°€μ—κ² μ”μ²­ν•  μ μμ–΄μ”</p>
            <p>β οΈ μΉμΈ ν›„μ—λ” μμ •ν•  μ μ—†μΌλ‹ λ‚΄μ©μ„ κΌΌκΌΌν ν™•μΈν•΄μ£Όμ„Έμ”</p>
          </div>
        </div>
      </div>
    </div>
  <% when 'draft' %>
    <div class="mb-6 bg-gradient-to-r from-gray-50 to-slate-50 rounded-2xl p-6 border-l-4 border-gray-400">
      <div class="flex items-start gap-3">
        <span class="text-3xl">βοΈ</span>
        <div class="flex-1">
          <h3 class="font-bold text-gray-900 text-lg mb-1">μ‘μ„± μ¤‘μ΄μ—μ”</h3>
          <p class="text-gray-700 text-sm mb-3">λ‚΄μ©μ„ ν™•μΈν•κ³  μ μ¶ν•μ‹λ©΄ λ³΄ν—μ‚¬μ— μ ‘μλΌμ”</p>
          <p class="text-xs text-gray-600">π’΅ μ„μ‹ μ €μ¥λ μƒνƒμμ”. μ–Έμ λ“ μ§€ μμ •ν•  μ μμ–΄μ”</p>
        </div>
      </div>
    </div>
  <% when 'submitted' %>
    <div class="mb-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 border-l-4 border-blue-500">
      <div class="flex items-start gap-3">
        <span class="text-3xl">π“¥</span>
        <div class="flex-1">
          <h3 class="font-bold text-gray-900 text-lg mb-1">μ‹ μ²­μ„κ°€ μ¤€λΉ„λμ—μ–΄μ”!</h3>
          <p class="text-gray-700 text-sm mb-4">μ•„λ λ²„νΌμ„ λλ¬ λ³΄ν—μ‚¬μ— μ μ¶ν•΄μ£Όμ„Έμ”</p>

          <!-- PDF λ‹¤μ΄λ΅λ“ + λ³΄ν—μ‚¬ λ°”λ΅κ°€κΈ° λ²„νΌ -->
          <div class="flex flex-col sm:flex-row gap-3 mb-4">
            <%= link_to download_pdf_customers_insurance_claim_path(@insurance_claim),
                        class: "inline-flex items-center justify-center px-5 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors shadow-sm" do %>
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
              </svg>
              π“„ μ‹ μ²­μ„ PDF λ‹¤μ΄λ΅λ“
            <% end %>

            <button type="button" onclick="openInsuranceGuide()"
                    class="inline-flex items-center justify-center px-5 py-3 bg-emerald-600 text-white font-semibold rounded-lg hover:bg-emerald-700 transition-colors shadow-sm">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
              </svg>
              πΆ λ³΄ν—μ‚¬ λ°”λ΅κ°€κΈ°
            </button>

            <%= button_to auto_submit_customers_insurance_claim_path(@insurance_claim),
                          method: :patch,
                          data: { confirm: "λ³΄ν—μ‚¬μ— μ‹ μ²­μ„λ¥Ό μλ™μΌλ΅ μ΄λ©”μΌ λ°μ†΅ν•©λ‹λ‹¤. κ³„μ†ν•μ‹κ² μµλ‹κΉ?" },
                          class: "inline-flex items-center justify-center px-5 py-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition-colors shadow-sm" do %>
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
              </svg>
              β΅ μλ™ μ μ¶ (μ΄λ©”μΌ)
            <% end %>
          </div>

          <div class="text-xs text-gray-600 space-y-1">
            <p>π“± <strong>μλ™ μ μ¶:</strong> λ³΄ν—μ‚¬ μ•±/μ›Ήμ—μ„ 1λ¶„ μ•μ— μ™„λ£!</p>
            <p>β΅ <strong>μλ™ μ μ¶:</strong> λ³΄ν—μ‚¬μ— μ¦‰μ‹ μ΄λ©”μΌλ΅ λ°μ†΅λ©λ‹λ‹¤</p>
            <p>π’΅ μ μ¶ ν›„ "μ‹¬μ‚¬ μ‹μ‘" λ²„νΌμ„ λλ¬μ£Όμ‹λ©΄ μ§„ν–‰ μƒν™©μ„ μ¶”μ ν•΄λ“λ ¤μ”</p>
          </div>
        </div>
      </div>
    </div>
  <% when 'under_review' %>
    <div class="mb-6 bg-gradient-to-r from-yellow-50 to-amber-50 rounded-2xl p-6 border-l-4 border-yellow-500">
      <div class="flex items-start gap-3">
        <span class="text-3xl">π”</span>
        <div class="flex-1">
          <h3 class="font-bold text-gray-900 text-lg mb-1">μ‹¬μ‚¬ μ¤‘μ΄μ—μ”</h3>
          <p class="text-gray-700 text-sm mb-3">λ³΄ν—μ‚¬μ—μ„ μ„λ¥λ¥Ό κ²€ν† ν•κ³  μμ–΄μ”</p>
          <div class="text-xs text-gray-600 space-y-1">
            <p>β±οΈ ν‰κ·  7~14μΌ μ •λ„ μ†μ”λΌμ”</p>
            <p>π“ μ‹¬μ‚¬ κ΄€λ ¨ λ¬Έμμ‚¬ν•­μ΄ μμΌλ©΄ μ—°λ½λ“λ¦΄ κ±°μμ”</p>
          </div>
        </div>
      </div>
    </div>
  <% when 'approved' %>
    <div class="mb-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-6 border-l-4 border-green-500">
      <div class="flex items-start gap-3">
        <span class="text-3xl">β…</span>
        <div class="flex-1">
          <h3 class="font-bold text-gray-900 text-lg mb-1">μΉμΈλμ—μ–΄μ”!</h3>
          <p class="text-gray-700 text-sm mb-3">λ³΄ν—κΈ μ§€κΈ‰ μ μ°¨κ°€ μ§„ν–‰λ  κ±°μμ”</p>
          <div class="text-xs text-gray-600 space-y-1">
            <p>π’° κ³§ κ³„μΆλ΅ λ³΄ν—κΈμ΄ μ…κΈλ  μμ •μ΄μ—μ”</p>
            <p>π“§ μ§€κΈ‰ μ™„λ£λλ©΄ μ•λ ¤λ“λ¦΄κ²μ”</p>
          </div>
        </div>
      </div>
    </div>
  <% when 'rejected' %>
    <div class="mb-6 bg-gradient-to-r from-red-50 to-rose-50 rounded-2xl p-6 border-l-4 border-red-500">
      <div class="flex items-start gap-3">
        <span class="text-3xl">β</span>
        <div class="flex-1">
          <h3 class="font-bold text-gray-900 text-lg mb-1">λ°λ ¤λμ—μ–΄μ”</h3>
          <p class="text-gray-700 text-sm mb-3">λ³΄ν—μ‚¬ μ‹¬μ‚¬ κ²°κ³Ό μΉμΈμ΄ μ–΄λ µλ‹¤κ³  νλ‹¨λμ—μ–΄μ”</p>
          <div class="text-xs text-gray-600 space-y-1">
            <p>π“ μμ„Έν• μ‚¬μ λ” λ³΄ν—μ‚¬λ΅ λ¬Έμν•΄μ£Όμ„Έμ”</p>
            <p>π’΅ ν•„μ”ν• κ²½μ° μ΄μμ‹ μ²­μ„ ν•  μ μμ–΄μ”</p>
          </div>
        </div>
      </div>
    </div>
  <% when 'completed' %>
    <div class="mb-6 bg-gradient-to-r from-purple-50 to-violet-50 rounded-2xl p-6 border-l-4 border-purple-500">
      <div class="flex items-start gap-3">
        <span class="text-3xl">π‰</span>
        <div class="flex-1">
          <h3 class="font-bold text-gray-900 text-lg mb-1">λ¨λ“  μ μ°¨κ°€ μ™„λ£λμ—μ–΄μ”</h3>
          <p class="text-gray-700 text-sm mb-3">λ³΄ν—κΈ μ§€κΈ‰μ΄ μ™„λ£λμ—μ–΄μ”</p>
          <p class="text-xs text-gray-600">π’° κ³„μΆλ¥Ό ν™•μΈν•΄λ³΄μ„Έμ”</p>
        </div>
      </div>
    </div>
  <% end %>

  <!-- μ •λ³΄ μΉ΄λ“ -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 divide-y">
    <!-- μ‹ μ²­μ μ •λ³΄ -->
    <div class="p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
        <span>π‘¤</span>
        <span>μ‹ μ²­μ μ •λ³΄</span>
      </h3>
      <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-3 text-sm">
        <div>
          <dt class="text-gray-500">μ„±λ…</dt>
          <dd class="font-medium text-gray-900"><%= @insurance_claim.applicant_name %></dd>
        </div>
        <div>
          <dt class="text-gray-500">μ—°λ½μ²</dt>
          <dd class="font-medium text-gray-900"><%= @insurance_claim.applicant_phone %></dd>
        </div>
        <div>
          <dt class="text-gray-500">μ΄λ©”μΌ</dt>
          <dd class="font-medium text-gray-900"><%= @insurance_claim.applicant_email || "-" %></dd>
        </div>
        <div>
          <dt class="text-gray-500">μƒλ…„μ›”μΌ</dt>
          <dd class="font-medium text-gray-900"><%= @insurance_claim.birth_date&.strftime("%Y.%m.%d") || "-" %></dd>
        </div>
      </dl>
    </div>

    <!-- μ‚¬κ³  μ •λ³΄ -->
    <div class="p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
        <span>π¨</span>
        <span>μ‚¬κ³  μ •λ³΄</span>
      </h3>
      <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-3 text-sm">
        <div>
          <dt class="text-gray-500">μ‚¬κ³  λ°μƒμΌ</dt>
          <dd class="font-medium text-gray-900"><%= @insurance_claim.incident_date.strftime("%Y.%m.%d") %></dd>
        </div>
        <div>
          <dt class="text-gray-500">ν”Όν•΄ μ ν•</dt>
          <dd class="font-medium text-gray-900"><%= @insurance_claim.damage_type_label %></dd>
        </div>
        <div class="sm:col-span-2">
          <dt class="text-gray-500">μ‚¬κ³  μ¥μ†</dt>
          <dd class="font-medium text-gray-900">
            <%= @insurance_claim.incident_address %>
            <% if @insurance_claim.incident_detail_address.present? %>
              <span class="text-gray-500"><%= @insurance_claim.incident_detail_address %></span>
            <% end %>
          </dd>
        </div>
        <% if @insurance_claim.estimated_damage_amount.present? %>
          <div>
            <dt class="text-gray-500">μμƒ ν”Όν•΄ κΈμ•΅</dt>
            <dd class="font-medium text-gray-900"><%= number_to_currency(@insurance_claim.estimated_damage_amount, unit: "β‚©", precision: 0) %></dd>
          </div>
        <% end %>
        <div class="sm:col-span-2">
          <dt class="text-gray-500">μ‚¬κ³  λ‚΄μ©</dt>
          <dd class="font-medium text-gray-900 whitespace-pre-line"><%= @insurance_claim.incident_description %></dd>
        </div>
      </dl>
    </div>

    <!-- λ³΄ν— μ •λ³΄ -->
    <div class="p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
        <span>π›΅οΈ</span>
        <span>λ³΄ν— μ •λ³΄</span>
      </h3>
      <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-3 text-sm">
        <div>
          <dt class="text-gray-500">λ³΄ν—μ‚¬</dt>
          <dd class="font-medium text-gray-900"><%= @insurance_claim.insurance_company || "-" %></dd>
        </div>
        <div>
          <dt class="text-gray-500">μ¦κ¶λ²νΈ</dt>
          <dd class="font-medium text-gray-900"><%= @insurance_claim.policy_number || "-" %></dd>
        </div>
      </dl>
    </div>

    <!-- ν”Όν•΄μ μ •λ³΄ -->
    <% if @insurance_claim.victim_name.present? %>
      <div class="p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
          <span>π‘¥</span>
          <span>ν”Όν•΄μ μ •λ³΄</span>
        </h3>
        <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-3 text-sm">
          <div>
            <dt class="text-gray-500">μ„±λ…</dt>
            <dd class="font-medium text-gray-900"><%= @insurance_claim.victim_name %></dd>
          </div>
          <div>
            <dt class="text-gray-500">μ—°λ½μ²</dt>
            <dd class="font-medium text-gray-900"><%= @insurance_claim.victim_phone || "-" %></dd>
          </div>
          <% if @insurance_claim.victim_address.present? %>
            <div class="sm:col-span-2">
              <dt class="text-gray-500">μ£Όμ†</dt>
              <dd class="font-medium text-gray-900"><%= @insurance_claim.victim_address %></dd>
            </div>
          <% end %>
        </dl>
      </div>
    <% end %>

    <!-- μ—°κ²°λ μ‹ κ³  -->
    <% if @insurance_claim.request.present? %>
      <div class="p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
          <span>π”—</span>
          <span>μ—°κ΄€ λ„μ μ‹ κ³ </span>
        </h3>
        <div class="flex items-center justify-between bg-gray-50 rounded-lg p-3">
          <div class="text-sm">
            <span class="font-mono text-gray-500">NSC-<%= @insurance_claim.request.id.to_s.rjust(6, '0') %></span>
            <span class="ml-2 text-gray-700"><%= @insurance_claim.request.address.truncate(30) %></span>
          </div>
          <%= link_to "μƒμ„Έλ³΄κΈ°", customers_request_path(@insurance_claim.request),
                class: "text-sm text-blue-600 hover:text-blue-800" %>
        </div>
      </div>
    <% end %>

    <!-- μ¦λΉ™ μ„λ¥ -->
    <% if @insurance_claim.supporting_documents.attached? %>
      <div class="p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
          <span>π“</span>
          <span>μ¦λΉ™ μ„λ¥</span>
          <span class="text-sm font-normal text-gray-500">(<%= @insurance_claim.supporting_documents.count %>κ°)</span>
        </h3>
        <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
          <% @insurance_claim.supporting_documents.each do |doc| %>
            <% if doc.content_type.start_with?("image/") %>
              <%= image_tag doc, class: "rounded-lg shadow-sm object-cover h-32 w-full" %>
            <% else %>
              <div class="bg-gray-50 rounded-lg p-4 flex items-center text-sm text-gray-600">
                <svg class="w-5 h-5 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                </svg>
                <%= doc.filename %>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- μ•΅μ… λ²„νΌ -->
  <div class="mt-8">
    <% if @insurance_claim.pending_customer_review? %>
      <div class="bg-gradient-to-br from-yellow-50 to-amber-50 rounded-2xl p-6 border border-yellow-100 mb-4">
        <p class="text-sm text-gray-700 mb-4 flex items-start gap-2">
          <svg class="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
          </svg>
          <span>μ „λ¬Έκ°€κ°€ μ‘μ„±ν• λ‚΄μ©μ„ ν™•μΈν•΄μ£Όμ„Έμ”. <strong>μΉμΈν•μ‹λ©΄ μλ™μΌλ΅ λ³΄ν—μ‚¬μ— μ μ¶</strong>λΌμ”</span>
        </p>
        <div class="flex flex-col gap-3">
          <div class="flex flex-wrap gap-3 justify-end">
            <%= button_to customer_approve_customers_insurance_claim_path(@insurance_claim),
                  method: :post,
                  class: "inline-flex items-center px-8 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition shadow-lg hover:shadow-xl",
                  data: { turbo_confirm: "β… λ³΄ν—μ²­κµ¬μ„λ¥Ό μΉμΈν•μ‹κ² μ–΄μ”?\n\nμΉμΈν•μ‹λ©΄ μ¦‰μ‹ λ³΄ν—μ‚¬λ΅ μ μ¶λ©λ‹λ‹¤. λ‚΄μ©μ„ λ‹¤μ‹ ν•λ² ν™•μΈν•΄μ£Όμ„Έμ”." } do %>
              β… μΉμΈν•κ³  λ³΄ν—μ‚¬μ— μ μ¶ν•κΈ°
            <% end %>
          </div>
          <details class="bg-white rounded-lg p-4 border border-yellow-200">
            <summary class="text-sm font-medium text-gray-900 cursor-pointer hover:text-gray-700">π“ μμ •μ΄ ν•„μ”ν•μ‹ κ°€μ”? (ν΄λ¦­ν•μ—¬ μμ • μ”μ²­)</summary>
            <%= form_with url: customer_request_changes_customers_insurance_claim_path(@insurance_claim), method: :post, class: "mt-3 space-y-3" do |f| %>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">μμ • μ”μ²­μ‚¬ν•­μ„ μμ„Έν μ μ–΄μ£Όμ„Έμ”</label>
                <%= text_area_tag :customer_review_notes, nil, rows: 4,
                      required: true,
                      placeholder: "μμ‹:\n- κ³µμ‚¬ κΈμ•΅μ„ 550,000μ›μΌλ΅ μμ •ν•΄μ£Όμ„Έμ”\n- μ‚¬κ³  λ‚΄μ©μ— μ•„λμΈµ ν”Όν•΄ λ‚΄μ©λ„ μ¶”κ°€ν•΄μ£Όμ„Έμ”\n- ν”Όν•΄μ μ—°λ½μ²λ¥Ό 010-9876-5432λ΅ λ³€κ²½ν•΄μ£Όμ„Έμ”",
                      class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-sm" %>
                <p class="text-xs text-gray-500 mt-1">μ „λ¬Έκ°€κ°€ ν™•μΈν•κ³  μμ •ν•΄λ“λ¦΄ κ±°μμ”</p>
              </div>
              <div class="flex justify-end">
                <%= button_tag type: :submit,
                      class: "inline-flex items-center px-6 py-2.5 bg-yellow-600 text-white rounded-lg font-medium hover:bg-yellow-700 transition" do %>
                  π“¤ μμ • μ”μ²­ λ³΄λ‚΄κΈ°
                <% end %>
              </div>
            <% end %>
          </details>
        </div>
      </div>
    <% elsif @insurance_claim.draft? && !@insurance_claim.prepared_by_master? %>
      <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-100 mb-4">
        <p class="text-sm text-gray-700 mb-4 flex items-start gap-2">
          <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
          </svg>
          <span>λ‚΄μ©μ„ ν™•μΈν•μ…¨λ‚μ”? <strong>μ μ¶ν•μ‹λ©΄ λ³΄ν—μ‚¬λ΅ μ ‘μ</strong>λΌμ”. μ μ¶ ν›„μ—λ” μμ •ν•  μ μ—†μΌλ‹ μ‹ μ¤‘ν•κ² ν™•μΈν•΄μ£Όμ„Έμ”</span>
        </p>
        <div class="flex flex-wrap gap-3 justify-end">
          <%= link_to edit_customers_insurance_claim_path(@insurance_claim),
                class: "inline-flex items-center px-5 py-2.5 rounded-lg font-medium text-gray-700 bg-white hover:bg-gray-50 transition border border-gray-300" do %>
            βοΈ μμ •ν•κΈ°
          <% end %>
          <%= button_to submit_claim_customers_insurance_claim_path(@insurance_claim),
                method: :post,
                class: "inline-flex items-center px-8 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition shadow-lg hover:shadow-xl",
                data: { turbo_confirm: "β… μ‹ μ²­μ„λ¥Ό μ μ¶ν•μ‹κ² μ–΄μ”?\n\nμ μ¶ ν›„μ—λ” μμ •ν•  μ μ—†μΌλ‹ λ‚΄μ©μ„ λ‹¤μ‹ ν•λ² ν™•μΈν•΄μ£Όμ„Έμ”." } do %>
            π“¤ λ³΄ν—μ‚¬μ— μ μ¶ν•κΈ°
          <% end %>
        </div>
      </div>
    <% else %>
      <div class="flex flex-wrap gap-3 justify-end">
        <%= link_to download_pdf_customers_insurance_claim_path(@insurance_claim),
              class: "inline-flex items-center gap-2 px-6 py-3 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition shadow-lg" do %>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          PDFλ΅ λ‹¤μ΄λ΅λ“
        <% end %>
      </div>
      <p class="text-xs text-center text-gray-500 mt-3">μ‹ μ²­μ„λ¥Ό PDF νμΌλ΅ μ €μ¥ν•  μ μμ–΄μ”</p>
    <% end %>
  </div>
</div>

<!-- λ³΄ν—μ‚¬ μ μ¶ κ°€μ΄λ“ λ¨λ‹¬ -->
<div id="insuranceGuideModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" onclick="if(event.target === this) closeInsuranceGuide()">
  <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
    <div class="p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-900">πΆ λ³΄ν—μ‚¬ μ μ¶ λ°©λ²•</h2>
        <button onclick="closeInsuranceGuide()" class="text-gray-400 hover:text-gray-600 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- λ³΄ν—μ‚¬λ³„ κ°€μ΄λ“ -->
      <div class="space-y-4">
        <% InsuranceSubmissionService.all_companies_guide.each do |company| %>
          <div class="border border-gray-200 rounded-xl p-4 hover:border-blue-400 hover:shadow-md transition-all">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-bold text-lg flex items-center gap-2">
                <span class="text-2xl"><%= company[:logo_emoji] %></span>
                <%= company[:company_name] %>
              </h3>
              <a href="<%= company[:website] %>" target="_blank" rel="noopener"
                 class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition-colors shadow-sm">
                λ°”λ΅κ°€κΈ° β†’
              </a>
            </div>
            <div class="space-y-2 text-sm text-gray-700">
              <p><strong>π“± μ•±:</strong> "<%= company[:app_name] %>" β†’ <%= company[:claim_menu] %></p>
              <p><strong>π’» μ›Ή:</strong> <%= company[:website] %></p>
              <p><strong>βοΈ μ „ν™”:</strong> <%= company[:phone] %></p>
              <p class="text-xs text-gray-500 mt-2">π’΅ ν•„μ” μ„λ¥: λ‹¤μ΄λ΅λ“ν• PDF + ν”Όν•΄ μ‚¬μ§„</p>
            </div>
          </div>
        <% end %>
      </div>

      <!-- κ³µν†µ μ•λ‚΄ -->
      <div class="mt-6 p-4 bg-gradient-to-br from-gray-50 to-slate-50 rounded-xl border border-gray-200">
        <h4 class="font-semibold text-gray-900 mb-3 flex items-center gap-2">
          <span class="text-xl">π“</span>
          <span>μ μ¶ μ‹ μ μμ‚¬ν•­</span>
        </h4>
        <ul class="space-y-2 text-sm text-gray-700">
          <li class="flex items-start gap-2">
            <span class="text-blue-600 font-bold">β€Ά</span>
            <span>PDF μ‹ μ²­μ„ + λ„μ ν”Όν•΄ μ‚¬μ§„μ„ ν•¨κ» μ μ¶ν•μ„Έμ”</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-blue-600 font-bold">β€Ά</span>
            <span>λ³΄ν—μ‚¬ μ•±/μ›Ήμ—μ„ <strong>"μΌμƒλ°°μƒμ±…μ„λ³΄ν—"</strong> μ„ νƒ</span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-blue-600 font-bold">β€Ά</span>
            <span>μ‚¬κ³  λ‚ μ§: <strong><%= @insurance_claim.incident_date.strftime("%Yλ…„ %mμ›” %dμΌ") %></strong></span>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-blue-600 font-bold">β€Ά</span>
            <span>μ μ¶ μ™„λ£ ν›„ μ΄ νμ΄μ§€μ—μ„ <strong>"μ‹¬μ‚¬ μ‹μ‘"</strong> λ²„νΌμ„ λλ¬μ£Όμ„Έμ”</span>
          </li>
        </ul>
      </div>

      <!-- μ μ¶ ν›„ μ•λ‚΄ -->
      <div class="mt-4 p-4 bg-blue-50 rounded-xl border border-blue-200">
        <p class="text-sm text-blue-900 flex items-start gap-2">
          <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
          </svg>
          <span><strong>λ³΄ν—μ‚¬μ— μ μ¶ν•μ…¨λ‚μ”?</strong> μ•„λ "μ‹¬μ‚¬ μ‹μ‘" λ²„νΌμ„ λλ¬ μ§„ν–‰ μƒν™©μ„ μ¶”μ ν•μ„Έμ”!</span>
        </p>
      </div>
    </div>
  </div>
</div>

<!-- μ‹¬μ‚¬ μ‹μ‘ λ²„νΌ (submitted μƒνƒμΌ λ•λ§) -->
<% if @insurance_claim.submitted? %>
  <div class="max-w-3xl mx-auto mt-6">
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
      <div class="flex items-start gap-4">
        <div class="flex-shrink-0">
          <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center">
            <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
        </div>
        <div class="flex-1">
          <h3 class="font-bold text-gray-900 mb-2">λ³΄ν—μ‚¬μ— μ μ¶μ„ μ™„λ£ν•μ…¨λ‚μ”?</h3>
          <p class="text-sm text-gray-600 mb-4">μ μ¶ν•μ‹  ν›„ μ•„λ λ²„νΌμ„ λλ¬μ£Όμ‹λ©΄ μ‹¬μ‚¬ μ§„ν–‰ μƒν™©μ„ μ¶”μ ν•΄λ“λ ¤μ”</p>
          <%= button_to start_review_customers_insurance_claim_path(@insurance_claim),
                        method: :patch,
                        data: { confirm: "λ³΄ν—μ‚¬μ— μ μ¶μ„ μ™„λ£ν•μ…¨λ‚μ”?\n\nν™•μΈν•μ‹λ©΄ μ‹¬μ‚¬ μ¤‘ μƒνƒλ΅ λ³€κ²½λ©λ‹λ‹¤." },
                        class: "w-full sm:w-auto px-6 py-3 bg-yellow-500 text-white font-semibold rounded-lg hover:bg-yellow-600 transition-colors shadow-sm inline-flex items-center justify-center gap-2" do %>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            β… λ³΄ν—μ‚¬ μ μ¶ μ™„λ£ β†’ μ‹¬μ‚¬ μ‹μ‘
          <% end %>
        </div>
      </div>
    </div>
  </div>
<% end %>

<script>
function openInsuranceGuide() {
  document.getElementById('insuranceGuideModal').classList.remove('hidden');
  document.body.style.overflow = 'hidden'; // λ°°κ²½ μ¤ν¬λ΅¤ λ°©μ§€
}

function closeInsuranceGuide() {
  document.getElementById('insuranceGuideModal').classList.add('hidden');
  document.body.style.overflow = 'auto'; // λ°°κ²½ μ¤ν¬λ΅¤ λ³µμ›
}

// ESC ν‚¤λ΅ λ¨λ‹¬ λ‹«κΈ°
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeInsuranceGuide();
  }
});
</script>
