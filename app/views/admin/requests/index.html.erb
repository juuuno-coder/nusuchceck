<div class="space-y-6">
  <h1 class="text-2xl font-bold text-gray-900">전체 신고 관리</h1>

  <!-- 검색/필터 -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4">
    <%= search_form_for @q, url: admin_requests_path, html: { method: :get, class: "flex flex-col sm:flex-row gap-3" } do |f| %>
      <div class="flex-1">
        <%= f.search_field :customer_name_or_address_cont,
              placeholder: "고객명 또는 주소 검색...",
              class: input_classes(:text) %>
      </div>
      <div class="flex-1">
        <%= f.select :status_eq,
              options_for_select([
                ["전체 상태", ""],
                ["접수됨", "reported"],
                ["마스터 배정", "assigned"],
                ["방문 중", "visiting"],
                ["탐지 중", "detecting"],
                ["누수 미확인", "no_leak_found"],
                ["견적 대기", "estimate_pending"],
                ["견적 제출", "estimate_submitted"],
                ["공사 합의", "construction_agreed"],
                ["에스크로 입금", "escrow_deposited"],
                ["공사 진행", "constructing"],
                ["공사 완료", "construction_completed"],
                ["종료", "closed"],
                ["취소", "cancelled"]
              ], params.dig(:q, :status_eq)),
              {}, class: input_classes(:select) %>
      </div>
      <div class="flex gap-2">
        <%= f.submit "검색", class: btn_classes(:primary, :md) %>
        <%= link_to "초기화", admin_requests_path, class: btn_classes(:secondary, :md) %>
      </div>
    <% end %>
  </div>

  <!-- 데스크톱 테이블 -->
  <div class="hidden md:block bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200" aria-label="신고 목록">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">접수번호</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">고객</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">마스터</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">증상</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">상태</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">접수일</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          <% @requests.each do |request| %>
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap">
                <%= link_to "##{request.id}", admin_request_path(request), class: "text-blue-600 hover:text-blue-800 font-mono text-sm font-medium" %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= request.customer&.name || "-" %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600"><%= request.master&.name || "-" %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600"><%= symptom_label(request.symptom_type) %></td>
              <td class="px-6 py-4 whitespace-nowrap"><%= render "shared/status_badge", status: request.status %></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><%= request.created_at.strftime("%Y-%m-%d %H:%M") %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- 모바일 카드 목록 -->
  <div class="md:hidden space-y-3">
    <% @requests.each do |request| %>
      <%= link_to admin_request_path(request), class: "block bg-white rounded-xl shadow-sm border border-gray-100 p-4 hover:shadow-md transition" do %>
        <div class="flex items-center justify-between mb-2">
          <span class="text-sm font-mono text-gray-500 font-medium">#<%= request.id %></span>
          <%= render "shared/status_badge", status: request.status %>
        </div>
        <p class="text-sm font-medium text-gray-900"><%= request.customer&.name || "-" %></p>
        <p class="text-sm text-blue-600 mt-1"><%= symptom_label(request.symptom_type) %></p>
        <div class="flex items-center justify-between mt-2 text-xs text-gray-500">
          <span>마스터: <%= request.master&.name || "미배정" %></span>
          <span><%= request.created_at.strftime("%m/%d %H:%M") %></span>
        </div>
      <% end %>
    <% end %>
  </div>

  <!-- 페이지네이션 -->
  <div class="mt-6">
    <%= paginate @requests %>
  </div>
</div>
